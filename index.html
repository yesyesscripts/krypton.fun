<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Krypton.fun</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<style>
@import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap");

body {
  background: #000; /* black background */
  color: #fff;
  font-family: "Poppins", sans-serif;
  overflow-x: hidden;
}

/* PARTICLES */
#particles {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
}

/* APP */
.app { position: relative; z-index: 10; }

/* SEARCH */
.search {
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(14px);
  border: 1px solid rgba(255,255,255,0.1);
}

/* DOCK */
.dock {
  background: rgba(0,0,0,0.9);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255,255,255,0.1);
  transition: 0.3s;
  z-index: 20;
}
.dock:hover {
  box-shadow: 0 0 15px rgba(255,255,255,0.3);
}

/* DOCK BUTTONS */
.dock-btn {
  width: 52px;
  height: 52px;
  border-radius: 9999px;
  display: grid;
  place-items: center;
  color: #ccc;
  position: relative;
  transition: 0.25s;
}
.dock-btn:hover { color: #fff; }
.dock-btn.active {
  background: rgba(255,255,255,0.1);
  box-shadow: 0 0 0 2px rgba(255,255,255,0.2);
  color: #fff;
  transform: scale(1.05);
}

/* TOOLTIP */
.tooltip {
  position: absolute;
  bottom: 68px;
  background: rgba(50,50,50,0.95);
  padding: 4px 10px;
  font-size: 11px;
  border-radius: 999px;
  opacity: 0;
  transform: translateY(6px);
  transition: 0.2s;
  pointer-events: none;
  white-space: nowrap;
}
.dock-btn:hover .tooltip {
  opacity: 1;
  transform: translateY(0);
}

/* DIVIDER */
.divider {
  width: 1px;
  height: 28px;
  background: rgba(255,255,255,0.15);
}

/* POPUP */
.popup {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  backdrop-filter: blur(6px);
  z-index: 50;
  display: flex;
  align-items: center;
  justify-content: center;
}
.popup-inner {
  width: 95%;
  height: 95%;
  max-width: 1400px;
  background: #111; /* dark popup background */
  border-radius: 16px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  z-index: 50;
}

/* TITLE MOUSE FOLLOW */
#title {
  display: inline-block;
  transition: transform 0.2s ease-out;
  color: #fff;
}

/* FULLSCREEN BUTTON */
.fullscreen-btn {
  background: rgba(255,255,255,0.1);
  color: #fff;
  padding: 6px 8px;
  border-radius: 8px;
  transition: all 0.25s;
}
.fullscreen-btn:hover {
  box-shadow: 0 0 10px rgba(255,255,255,0.3);
  transform: scale(1.1);
}

/* SETTINGS TOGGLE */
.toggle-bg {
  width: 56px;
  height: 28px;
  background: rgba(100,100,100,0.3);
  border-radius: 9999px;
  position: relative;
  transition: background 0.3s, box-shadow 0.3s;
}
.toggle-bg.active {
  background: #fff;
  box-shadow: 0 0 6px #fffaa;
}
.toggle-circle {
  width: 24px;
  height: 24px;
  background: #000;
  border-radius: 50%;
  position: absolute;
  top: 2px;
  left: 2px;
  transition: transform 0.3s;
}
.toggle-circle.active {
  transform: translateX(28px);
}

/* SETTINGS BOX */
.settings-box {
  background: #ddd; /* light gray box */
  border-radius: 16px;
  padding: 20px;
  max-width: 400px;
  width: 100%;
  box-shadow: 0 0 20px rgba(0,0,0,0.2);
  display: flex;
  flex-direction: column;
  gap: 16px;
  color: #000; /* text inside box black */
}

/* SETTINGS DROPDOWN */
select {
  background: #eee;
  color: #000;
  border: 1px solid #999;
  padding: 8px 10px;
  border-radius: 12px;
  outline: none;
  transition: box-shadow 0.3s;
}
select:focus {
  box-shadow: 0 0 10px #999;
}
select:disabled {
  background: #ccc;
  color: #666;
  border: 1px solid #888;
  cursor: not-allowed;
}
</style>
</head>

<body>

<canvas id="particles"></canvas>

<div x-data="app()" x-init="init()" class="app min-h-screen flex flex-col">

<!-- HOME -->
<section x-show="page==='home'" class="flex-1 flex flex-col items-center justify-center text-center px-6">
  <h1 id="title" class="text-6xl font-extrabold mb-4 drop-shadow-[0_0_20px_rgba(255,255,255,0.35)]">
    krypton<span class="text-gray-400">.</span>fun
  </h1>
  <p class="text-gray-400 max-w-xl text-sm">
    A modern unblocked game hub built for speed, simplicity, and smooth performance.
  </p>
</section>

<!-- GAMES -->
<section x-show="page==='games'" class="flex-1 px-6 pt-8 pb-32">
  <div class="max-w-xl mx-auto mb-10">
    <div class="search flex items-center gap-5 px-5 py-4 rounded-full">
      <i class="fa fa-search text-gray-400"></i>
      <input
        type="text"
        x-model="search"
        @input="applyFilters()"
        placeholder="Search for games..."
        class="bg-transparent outline-none flex-1 text-sm placeholder-gray-400"
      />
    </div>
  </div>

  <div class="max-w-7xl mx-auto grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
    <template x-for="game in filtered" :key="game.name">
      <div @click="openGame(game)"
        class="bg-[#111] rounded-xl overflow-hidden hover:scale-105 transition cursor-pointer">
        <div class="aspect-square bg-black/40">
          <img :src="getImage(game)" class="w-full h-full object-cover">
        </div>
        <div class="p-2 text-center text-xs font-semibold truncate" x-text="game.name"></div>
      </div>
    </template>
  </div>
</section>

<!-- SETTINGS -->
<section x-show="page==='settings'" class="flex-1 flex flex-col items-center justify-start pt-10 text-black">
  <!-- PARTICLE SETTINGS BOX -->
  <div class="settings-box">
    <div class="flex items-center justify-between">
      <span class="font-semibold">Particles</span>
      <button @click="particlesEnabled = !particlesEnabled" class="toggle-bg" :class="particlesEnabled ? 'active' : ''">
        <span class="toggle-circle" :class="particlesEnabled ? 'active' : ''"></span>
      </button>
    </div>

    <div class="flex flex-col">
      <label class="mb-2 font-semibold">Particle Mode</label>
      <select x-model="particleMode" :disabled="!particlesEnabled">
        <option value="falling">Falling</option>
        <option value="whisking">Whisking</option>
      </select>
    </div>
  </div>
</section>

<!-- GAME POPUP -->
<div x-show="popup" class="popup" @click.self="closeGame()">
  <div class="popup-inner">
    <div class="flex justify-between items-center px-4 py-3 border-b border-white/10">
      <span x-text="current?.name"></span>
      <div class="flex gap-2">
        <button class="fullscreen-btn" @click="fullscreenGame()">
          <i class="fa fa-expand"></i>
        </button>
        <button @click="closeGame()">
          <i class="fa fa-times"></i>
        </button>
      </div>
    </div>
    <iframe x-ref="frame" class="flex-1 w-full h-full"></iframe>
  </div>
</div>

<!-- DOCK -->
<div class="fixed bottom-6 left-1/2 -translate-x-1/2 dock rounded-full px-4 py-2 flex items-center gap-3">
  <button class="dock-btn" :class="{active:page==='home'}" @click="page='home'">
    <span class="tooltip">Home</span>
    <i class="fa fa-bolt"></i>
  </button>
  <div class="divider"></div>
  <button class="dock-btn" :class="{active:page==='games'}" @click="page='games'">
    <span class="tooltip">Games</span>
    <i class="fa fa-gamepad"></i>
  </button>
  <button class="dock-btn" :class="{active:page==='settings'}" @click="page='settings'">
    <span class="tooltip">Settings</span>
    <i class="fa fa-gear"></i>
  </button>
</div>

</div>

<script>
const cdn = "https://mathcenter.space";

function app() {
  return {
    page: "home",
    search: "",
    games: [],
    filtered: [],
    popup: false,
    current: null,

    // Particle settings
    particlesEnabled: true,
    particleMode: 'falling',

    async init() {
      const res = await fetch("https://corsproxy.io/?url=https://mathcenter.space/cdn/all");
      this.games = await res.json();
      this.applyFilters();
    },

    applyFilters() {
      this.filtered = this.games.filter(g =>
        g.name.toLowerCase().includes(this.search.toLowerCase())
      );
    },

    getImage(game) {
      return game.image?.startsWith("http")
        ? game.image
        : cdn + `/cdn/${game.url.split("/")[0]}/${game.image}`;
    },

    openGame(game) {
      this.current = game;
      this.popup = true;
      this.$nextTick(() => {
        this.$refs.frame.src = cdn + `/cdn/${game.url}/`;
      });
    },

    closeGame() {
      this.popup = false;
      this.$refs.frame.src = "about:blank";
    },

    fullscreenGame() {
      const iframe = this.$refs.frame;
      if (iframe.requestFullscreen) iframe.requestFullscreen();
      else if (iframe.webkitRequestFullscreen) iframe.webkitRequestFullscreen();
      else if (iframe.msRequestFullscreen) iframe.msRequestFullscreen();
    }
  };
}

// AlpineJS
const appInstance = app();
document.addEventListener("alpine:init", () => {
  Alpine.data('app', () => appInstance);
});

/* PARTICLES */
const canvas = document.getElementById("particles");
const ctx = canvas.getContext("2d");
let particles = [];

function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
window.addEventListener("resize", resize);
resize();

function spawn() {
  return {
    x: Math.random() * canvas.width,
    y: -10,
    r: Math.random() * 1.2 + 0.4,
    s: Math.random() * 0.6 + 0.3,
    offset: Math.random() * 50
  };
}

function loop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(appInstance.particlesEnabled && particles.length < 180) {
    particles.push(spawn());
  }

  particles.forEach(p => {
    if(!appInstance.particlesEnabled) return;

    if(appInstance.particleMode === 'falling') {
      p.y += p.s;
    } else if(appInstance.particleMode === 'whisking') {
      p.x += Math.sin((Date.now()/1000 + p.offset)) * 0.5;
      p.y += Math.cos((Date.now()/1000 + p.offset)) * 0.3;
    }

    ctx.beginPath();
    ctx.fillStyle = "rgba(255,255,255,0.75)";
    ctx.shadowBlur = 6;
    ctx.shadowColor = "white";
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
  });

  if(appInstance.particlesEnabled) {
    particles = particles.filter(p => p.y < canvas.height && p.x < canvas.width && p.x > 0);
  }

  requestAnimationFrame(loop);
}
loop();

/* TITLE MOUSE FOLLOW */
const title = document.getElementById("title");
let titleOffsetX = 0;
let titleOffsetY = 0;

document.addEventListener("mousemove", (e) => {
  const rect = title.getBoundingClientRect();
  const dx = e.clientX - (rect.left + rect.width / 2);
  const dy = e.clientY - (rect.top + rect.height / 2);
  const distance = Math.sqrt(dx*dx + dy*dy);

  const maxDist = 200;
  const maxOffset = 10;

  if(distance < maxDist) {
    titleOffsetX = -dx / maxDist * maxOffset;
    titleOffsetY = -dy / maxDist * maxOffset;
  } else {
    titleOffsetX = 0;
    titleOffsetY = 0;
  }
});

function animateTitle() {
  const currentTransform = title.style.transform.match(/translate\((.*)px, (.*)px\)/);
  let currentX = currentTransform ? parseFloat(currentTransform[1]) : 0;
  let currentY = currentTransform ? parseFloat(currentTransform[2]) : 0;

  currentX += (titleOffsetX - currentX) * 0.1;
  currentY += (titleOffsetY - currentY) * 0.1;

  title.style.transform = `translate(${currentX}px, ${currentY}px)`;
  requestAnimationFrame(animateTitle);
}
animateTitle();
</script>

</body>
</html>
